
{% extends "base.html" %}

{% block content %}
<div class="header">
    <h1>👑 Login - Salon Beleza Dourada</h1>
    <p>Acesse sua conta</p>
</div>

<div class="card" style="max-width: 500px; margin: 0 auto;">
    <form id="loginForm">
        <div class="form-group">
            <label for="username">Usuário:</label>
            <input type="text" id="username" class="form-control" required>
        </div>
        
        <div class="form-group">
            <label for="password">Senha:</label>
            <div style="position: relative;">
                <input type="password" id="password" class="form-control" required>
                <div style="margin-top: 8px;">
                    <label for="showPassword" style="font-size: 14px; font-weight: normal; color: rgba(255,215,0,0.8); cursor: pointer;">
                        <input type="checkbox" id="showPassword" style="margin-right: 8px;">
                        <span>👁️ Mostrar senha</span>
                    </label>
                </div>
            </div>
        </div>
        
        <div class="form-group text-center">
            <button type="submit" class="btn">Entrar</button>
            <a href="/register" class="btn btn-secondary" style="margin-left: 10px;">Cadastrar</a>
        </div>
        
        <div class="text-center" style="margin-top: 15px;">
            <a href="/forgot-password" style="color: #FFD700; font-size: 14px; text-decoration: underline;">
                🔑 Esqueceu sua senha?
            </a>
        </div>
    </form>
    
    <div class="text-center" style="margin-top: 20px;">
        <small style="color: rgba(255,215,0,0.7);">
            💼 Acesso administrativo: Entre com suas credenciais de admin
        </small>
    </div>
    
    <div class="text-center" style="margin-top: 20px;">
        <a href="/" style="color: #FFD700;">← Voltar ao início</a>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
// Garantir que o checkbox sempre inicie desmarcado
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('showPassword').checked = false;
});

// Toggle para mostrar/ocultar senha
function togglePassword() {
    const passwordField = document.getElementById('password');
    const showPasswordCheckbox = document.getElementById('showPassword');
    const labelSpan = showPasswordCheckbox.parentElement.querySelector('span');
    
    if (showPasswordCheckbox.checked) {
        passwordField.type = 'text';
        labelSpan.textContent = '🙈 Ocultar senha';
    } else {
        passwordField.type = 'password';
        labelSpan.textContent = '👁️ Mostrar senha';
    }
}

// Adicionar o event listener quando o DOM carregar
document.addEventListener('DOMContentLoaded', function() {
    const showPasswordCheckbox = document.getElementById('showPassword');
    if (showPasswordCheckbox) {
        showPasswordCheckbox.addEventListener('change', togglePassword);
    }
});

document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    
    if (!username || !password) {
        showAlert('Por favor, preencha todos os campos', 'error');
        return;
    }
    
    const formData = {
        username: username,
        password: password
    };
    
    console.log('Enviando dados de login:', formData);
    
    try {
        const response = await fetch('/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        console.log('Status da resposta:', response.status);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        console.log('Resultado do login:', result);
        
        if (result.success) {
            console.log('Redirecionando para:', result.redirect);
            window.location.href = result.redirect;
        } else {
            showAlert(result.message, 'error');
        }
    } catch (error) {
        console.error('Erro no login:', error);
        showAlert('Erro ao fazer login. Tente novamente.', 'error');
    }
});

// Função para mostrar alertas
function showAlert(message, type) {
    // Remove alertas existentes
    const existingAlert = document.querySelector('.alert');
    if (existingAlert) {
        existingAlert.remove();
    }
    
    // Cria novo alerta
    const alert = document.createElement('div');
    alert.className = `alert alert-${type}`;
    alert.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 5px;
        color: white;
        font-weight: bold;
        z-index: 9999;
        animation: slideIn 0.3s ease-out;
        ${type === 'error' ? 'background-color: #dc3545;' : 'background-color: #28a745;'}
    `;
    alert.textContent = message;
    
    document.body.appendChild(alert);
    
    // Remove após 5 segundos
    setTimeout(() => {
        if (alert.parentNode) {
            alert.remove();
        }
    }, 5000);
}
</script>
{% endblock %}
